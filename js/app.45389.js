(()=>{"use strict";var t={976:(t,e,n)=>{var i=n(187),r=n.n(i);function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}var h=function(){function t(){s(this,t),this.eventEmitter=new(r()),this.ready=!1,this.controller=new u(this.eventEmitter)}return l(t,[{key:"connect",value:function(){this.ready=!0,this.eventEmitter.emit("open")}},{key:"isReady",value:function(){return this.ready}},{key:"on",value:function(t,e){this.eventEmitter.on(t,e)}},{key:"send",value:function(t){var e=this;switch(console.log("api > send: %o",t),t.t){case"ping":this.controller.ping(t);break;case"tiles":setTimeout((function(){return e.controller.tiles(t)}),750+500*Math.random());break;case"place":this.controller.place(t);break;case"move":this.controller.move(t);break;default:console.warn("api > send: unknown packet ["+t.t+"]")}}}]),t}(),u=function(){function t(e){var n=this;s(this,t),this.eventEmitter=e,this.objects=[],setTimeout((function(){return setInterval(n.recycle.bind(n),1e3)}),5e3)}return l(t,[{key:"ping",value:function(t){this.eventEmitter.emit("pong",{tc:t.time,ts:Date.now()/1e3})}},{key:"tiles",value:function(t){var e=t.coords;if(e){for(var n=o(t.area,2)[1],i=[],r=1;r<e.length;r+=2){var a=n+e[r];i.push(Math.abs(a)%2)}this.eventEmitter.emit("tiles",{ref:t.ref,data:i})}}},{key:"place",value:function(t){var e=Math.random().toString(36).substring(2);this.objects.push(e),this.eventEmitter.emit("place",{objects:[{id:e,x:t.x,y:t.y}]})}},{key:"move",value:function(t){var e=this,n=t.id,i=this.objects.indexOf(n);i>=0&&this.objects.splice(i,1);var r=Date.now(),o=Math.floor(r/1e3),a=1+Math.floor(5*Math.random());this.eventEmitter.emit("move",{objects:[{id:n,x:t.x,y:t.y,time:o+1,duration:a}]}),setTimeout((function(){e.objects.push(n),e.eventEmitter.emit("moved",{id:n})}),1e3*a+(r-1e3*o))}},{key:"recycle",value:function(){if(0!==this.objects.length){var t=Math.floor(3*Math.random());0!==t&&this.eventEmitter.emit("remove",{objects:this.objects.splice(0,t)})}}}]),t}();function f(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var y=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;v(this,t),this.resources=e,this.owner=n||{}}var e,n,i;return e=t,(n=[{key:"load",value:function(t){var e,n=this,i=this.resources.length,r=f(this.resources);try{for(r.s();!(e=r.n()).done;){var o=e.value,a=new Image;this.owner[o.name]=a,a.onload=function(){0==--i&&t(n,n.owner)},a.src=o.url}}catch(t){r.e(t)}finally{r.f()}}}])&&d(e.prototype,n),i&&d(e,i),t}();const m=n.p+"static/tiles.b61e7.png",b=n.p+"static/sphere.30bb4.png";function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,i;return e=t,i=[{key:"load",value:function(t){new y([{name:"tiles",url:m},{name:"sphere",url:b}],this).load(t)}}],(n=null)&&g(e.prototype,n),i&&g(e,i),t}();function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var k=function(){return Date.now()/1e3},j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.ctx=e.getContext("2d"),this.ts=0,this.delta=0,this.render=this.render.bind(this),this.ping=this.ping.bind(this),this.api=new h,this.api.on("open",this.onopen.bind(this)),this.api.on("close",this.onclose.bind(this)),this.api.on("pong",this.onpong.bind(this))}var e,n,i;return e=t,(n=[{key:"start",value:function(){var t=this;if(!this.screen)throw new Error("screen is not set");w.load((function(){return t.api.connect()}))}},{key:"render",value:function(t){var e=(t-this.ts)/1e3;this.ts=t,e>.06&&console.warn("game > render : delta = %s",e),this.screen.render(e),this.requestId=window.requestAnimationFrame(this.render)}},{key:"onopen",value:function(){var t=this;this.ping(),this.timer=setInterval(this.ping,1e4),window.requestAnimationFrame((function(e){t.ts=e,t.render(e)}))}},{key:"onclose",value:function(){window.cancelAnimationFrame(this.requestId),this.requestId=null,clearInterval(this.timer),this.timer=null}},{key:"ping",value:function(){this.api.send({t:"ping",time:k()})}},{key:"onpong",value:function(t){console.log("game > onpong: %o",t);var e=k(),n=(e-t.tc)/2,i=t.ts-e;this.delta=i+n,console.log("game > latency: %sms; delta: %ss",(1e3*n).toFixed(1),this.delta.toFixed(6))}}])&&x(e.prototype,n),i&&x(e,i),t}(),S=n(50),E=n(75),O=n(126),I=n(388);function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=_(t);if(e){var r=_(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return C(this,n)}}function C(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(o,t);var e,n,i,r=P(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,e,n,new S.Z((e.world.tileSize.width-w.sphere.width)/2,(e.world.tileSize.height-w.sphere.height)/2,w.sphere.width,w.sphere.height))).ctx=t,i}return e=o,(n=[{key:"drawTile",value:function(t,e){if(this.moving)this.ctx.drawImage(w.sphere,t,e);else{var n=this.ctx.globalAlpha;this.ctx.globalAlpha=.9,this.ctx.drawImage(w.sphere,t,e),this.ctx.globalAlpha=n}}}])&&T(e.prototype,n),i&&T(e,i),o}((0,n(817).c)(O.R)),z=n(49);function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function D(t,e,n){return e&&q(t.prototype,e),n&&q(t,n),t}var Z=function(){function t(e){F(this,t),this.pos=e.pos,this.k=e.k,this.b=e.b,this.l=e.l,this.velocity=new z.Z}return D(t,[{key:"update",value:function(t){t>.06&&(t=.06);var e=this.pos.x,n=this.pos.y,i=Math.sqrt(e*e+n*n),r=i-this.l,o=0,a=0;if(r>0){var s=this.k*r/i;o=s*e,a=s*n}this.velocity.x+=t*(o+this.b*this.velocity.x),this.velocity.y+=t*(a+this.b*this.velocity.y),this.pos.scaleAndAdd(this.velocity,t)}}]),t}(),$=function(){function t(e){F(this,t),this.screen=e,this.viewport=e.map.viewport,this.placeOrMove=this.placeOrMove.bind(this),this.applyForce=this.applyForce.bind(this),this.api=e.api,this.api.on("open",this.onopen.bind(this)),this.api.on("close",this.onclose.bind(this)),this.spring=new Z({pos:this.viewport.position,k:-.25,b:-.05,l:512})}return D(t,[{key:"onopen",value:function(){var t=this;this.forceTimer=setInterval(this.applyForce,3e3),setTimeout((function(){t.timer=setInterval(t.placeOrMove,150)}),2e3)}},{key:"onclose",value:function(){clearInterval(this.timer),clearInterval(this.forceTimer),this.timer=null}},{key:"update",value:function(t){this.spring.update(t)}},{key:"applyForce",value:function(){var t=this.spring.velocity;t.x+=101*Math.random()-50,t.y+=101*Math.random()-50}},{key:"placeOrMove",value:function(){var t=this.screen.map.tiles,e=this.screen.objects,n=Math.floor(Math.random()*t.width+1)+t.left,i=Math.floor(Math.random()*t.height+1)+t.top;if(!e.find((function(t){return!t.moving&&t.tile.x===n&&t.tile.y===i||t.moving&&t.target.x===n&&t.target.y===i})))if(e.length<t.width*t.height/2)this.api.send({t:"place",x:n,y:i});else{var r=e[Math.floor(Math.random()*e.length)];r.moving||this.api.send({t:"move",id:r.id,x:n,y:i})}}}]),t}();function H(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var U=function(){function t(e,n,i,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.storage=n,this.tileSize=i,this.bounds=r,this.debug=o,o&&(this.ctx.font="12px monospace",this.ctx.fillStyle="white",this.ctx.textAlign="center")}var e,n,i;return e=t,(n=[{key:"begin",value:function(){}},{key:"drawTile",value:function(t,e,n,i){var r=this.storage.get(t,e);null!==r?(this.ctx.drawImage(w.tiles,this.tileSize.width*r,0,this.tileSize.width,this.tileSize.height,n,i,this.tileSize.width,this.tileSize.height),this.debug&&this.ctx.fillText(t+":"+e,n+this.tileSize.halfWidth,i+this.tileSize.halfHeight+3)):console.log("map renderer > draw tile: (%s:%s) is missing",t,e)}},{key:"drawSelected",value:function(t,e,n,i){}},{key:"end",value:function(){this.debug&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.rect(this.bounds.left,this.bounds.top,this.bounds.width,this.bounds.height),this.ctx.stroke())}}])&&H(e.prototype,n),i&&H(e,i),t}();function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var L={width:128,halfWidth:64,height:64,halfHeight:32},N=new S.Z(0,0,3*L.width,3*L.height),X=function(){function t(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];W(this,t),this.game=e,e.canvas.width=N.width,e.canvas.height=N.height,n&&(N.left=L.width+10,N.top=L.height,e.canvas.width+=2*N.left,e.canvas.height+=2*N.top),this.objects=[],this.sphere=null,this.api=e.api,this.api.on("open",this.onopen.bind(this)),this.api.on("place",this.onplace.bind(this)),this.api.on("remove",this.onremove.bind(this)),this.api.on("move",this.onmove.bind(this)),this.api.on("moved",this.onmoved.bind(this)),this.api.on("errors",this.onerrors.bind(this)),this.map=new E.Z(e.api,L,N),this.mapRenderer=new O.t(this.map,new U(e.ctx,this.map.storage,L,N,n)),(0,I.Z)(this.game.canvas).addEventListener("mousedrag",this.onmousedrag.bind(this)),this.controller=new $(this)}var e,n,i;return e=t,(n=[{key:"render",value:function(t){this.update(t),this.draw()}},{key:"update",value:function(t){this.controller.update(t),this.map.update(),this.objects.forEach((function(e){return e.update(t)}))}},{key:"draw",value:function(){this.game.ctx.clearRect(0,0,this.game.canvas.width,this.game.canvas.height),this.mapRenderer.draw(),this.objects.forEach((function(t){return t.draw()}))}},{key:"onmousedrag",value:function(t){this.map.viewport.position.x-=t.movementX,this.map.viewport.position.y-=t.movementY}},{key:"onopen",value:function(){this.objects=[]}},{key:"onerrors",value:function(t){console.warn("demo > onerrors: %o",t.errors)}},{key:"onplace",value:function(t){var e=this;console.log("demo > onplace: %o",t),t.objects.forEach((function(t){var n=t.id,i=e.objects.findIndex((function(t){return t.id===n}));if(i>=0){var r=e.objects[i];r.tile.x=t.x,r.tile.y=t.y}else{var o=new R(e.game.ctx,e.map.viewport,{x:t.x,y:t.y});o.id=t.id,e.objects.unshift(o)}}))}},{key:"onremove",value:function(t){var e=this;console.log("demo > onremove: %o",t),t.objects.forEach((function(t){var n=e.objects.findIndex((function(e){return e.id===t}));if(n>=0){var i=e.objects.splice(n,1)[0];e.sphere===i&&(e.sphere=null)}}))}},{key:"onmove",value:function(t){var e=this;console.log("demo > onmove: %o",t);var n=Date.now()/1e3+this.game.delta;t.objects.forEach((function(t){var i=t.id,r=e.objects.findIndex((function(t){return t.id===i}));if(r>=0){var o=e.objects.splice(r,1)[0];e.objects.push(o);var a=n-t.time;o.moveTo({x:t.x,y:t.y},t.duration,a)}}))}},{key:"onmoved",value:function(t){console.log("demo > onmoved: %o",t);var e=t.id,n=this.objects.findIndex((function(t){return t.id===e}));if(n>=0){var i=this.objects.splice(n,1)[0];this.objects.unshift(i),this.sphere===i&&(this.sphere=null)}}}])&&B(e.prototype,n),i&&B(e,i),t}(),Y=new j(document.body.appendChild(document.createElement("canvas")));Y.screen=new X(Y),Y.start()}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t+"../"})(),(()=>{var t={143:0},e=[[976,647]],i=()=>{};function r(){for(var i,r=0;r<e.length;r++){for(var o=e[r],a=!0,s=1;s<o.length;s++){var c=o[s];0!==t[c]&&(a=!1)}a&&(e.splice(r--,1),i=n(n.s=o[0]))}return 0===e.length&&(n.x(),n.x=()=>{}),i}n.x=()=>{n.x=()=>{},a=a.slice();for(var t=0;t<a.length;t++)o(a[t]);return(i=r)()};var o=r=>{for(var o,a,[c,l,h,u]=r,f=0,p=[];f<c.length;f++)a=c[f],n.o(t,a)&&t[a]&&p.push(t[a][0]),t[a]=0;for(o in l)n.o(l,o)&&(n.m[o]=l[o]);for(h&&h(n),s(r);p.length;)p.shift()();return u&&e.push.apply(e,u),i()},a=self.webpackChunkinfinite_tiles=self.webpackChunkinfinite_tiles||[],s=a.push.bind(a);a.push=o})(),n.x()})();