{"version":3,"file":"js/lib.68f67.js","mappings":"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CA;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,sBAAsB;AACxC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA,eAAe;AACf;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA,oBAAoB,SAAS;AAC7B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;;AAEA,kCAAkC,QAAQ;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB,iBAAiB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,QAAQ;AACR;AACA,uCAAuC,QAAQ;AAC/C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,OAAO;AACzB;AACA;AACA;;AAEA;AACA,SAAS,yBAAyB;AAClC;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,gBAAgB;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,8DAA8D,YAAY;AAC1E;AACA,8DAA8D,YAAY;AAC1E;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,qCAAqC,YAAY;AACjD;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA","sources":["webpack://infinite-tiles/./lib/draggable.js","webpack://infinite-tiles/./lib/math/rectangle.js","webpack://infinite-tiles/./lib/math/vector.js","webpack://infinite-tiles/./lib/staggered-map/cache.js","webpack://infinite-tiles/./lib/staggered-map/index.js","webpack://infinite-tiles/./lib/staggered-map/mixins.js","webpack://infinite-tiles/./lib/staggered-map/renderer.js","webpack://infinite-tiles/./lib/staggered-map/storage.js","webpack://infinite-tiles/./lib/staggered-map/viewport.js","webpack://infinite-tiles/./lib/staggered-map/world.js","webpack://infinite-tiles/./node_modules/events/events.js"],"sourcesContent":["export default function draggable(component) {\r\n  function onmousedown(e) {\r\n    component.addEventListener('mousemove', onmousemove);\r\n    component.addEventListener('mouseleave', onmouseup);\r\n  }\r\n\r\n  function onmousemove(e) {\r\n    if (e.movementX !== 0 || e.movementY !== 0) {\r\n      const event = new Event('mousedrag');\r\n      event.movementX = e.movementX;\r\n      event.movementY = e.movementY;\r\n      component.dispatchEvent(event);\r\n    }\r\n  }\r\n\r\n  function onmouseup(e) {\r\n    component.removeEventListener('mousemove', onmousemove);\r\n    component.removeEventListener('mouseleave', onmouseup);\r\n  }\r\n\r\n  component.addEventListener('mousedown', onmousedown);\r\n  component.addEventListener('mouseup', onmouseup);\r\n  return component;\r\n}\r\n","export default class Rectangle {\r\n  constructor(left = 0, top = 0, width = 0, height = 0) {\r\n    this.left = left;\r\n    this.top = top;\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  get right() {\r\n    return this.left + this.width;\r\n  }\r\n\r\n  get bottom() {\r\n    return this.top + this.height;\r\n  }\r\n\r\n  equals(other) {\r\n    return this.left == other.left && this.top == other.top &&\r\n      this.width == other.width && this.height == other.height;\r\n  }\r\n}\r\n","export default class Vector {\r\n  constructor(x = 0, y = 0) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  add(other) {\r\n    this.x += other.x;\r\n    this.y += other.y;\r\n    return this;\r\n  }\r\n\r\n  sub(other) {\r\n    this.x -= other.x;\r\n    this.y -= other.y;\r\n    return this;\r\n  }\r\n\r\n  scaleAndAdd(other, scale) {\r\n    this.x += other.x * scale;\r\n    this.y += other.y * scale;\r\n    return this;\r\n  }\r\n\r\n  lerp(target, progress) {\r\n    this.x = this.x + (target.x - this.x) * progress;\r\n    this.y = this.y + (target.y - this.y) * progress;\r\n    return this;\r\n  }\r\n}\r\n","\r\nexport default class Cache {\r\n  constructor(limit) {\r\n    this.limit = limit;\r\n    this.clear();\r\n  }\r\n\r\n  clear() {\r\n    this.items = new Map();\r\n    this.size = 0;\r\n    this.older = null;\r\n    this.newer = null;\r\n  }\r\n\r\n  get(key) {\r\n    const entry = this.items.get(key);\r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    this.used(key, entry);\r\n    return entry.value;\r\n  }\r\n\r\n  peek(key) {\r\n    const entry = this.items.get(key);\r\n    return entry ? entry.value : null;\r\n  }\r\n\r\n  has(key) {\r\n    return this.items.get(key) !== undefined;\r\n  }\r\n\r\n  touch(key) {\r\n    const entry = this.items.get(key);\r\n    if (!entry) {\r\n      return false;\r\n    }\r\n\r\n    this.used(key, entry);\r\n    return true;\r\n  }\r\n\r\n  set(key, value) {\r\n    let entry = this.items.get(key);\r\n    if (!entry) {\r\n      entry = {};\r\n      this.items.set(key, entry);\r\n      if (this.size < this.limit) {\r\n        this.size++;\r\n      } else {\r\n        this.evict();\r\n      }\r\n    }\r\n\r\n    this.used(key, entry);\r\n    entry.value = value;\r\n  }\r\n\r\n  remove(key) {\r\n    const entry = this.items.get(key);\r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    this.size--;\r\n    this.items.delete(key);\r\n    const o = entry.older;\r\n    const n = entry.newer;\r\n\r\n    if (this.older === key) {\r\n      this.older = n;\r\n    } else {\r\n      this.items.get(o).newer = n;\r\n    }\r\n\r\n    if (this.newer === key) {\r\n      this.newer = o;\r\n    } else {\r\n      this.items.get(n).older = o;\r\n    }\r\n\r\n    return entry.value;\r\n  }\r\n\r\n  // internal details\r\n\r\n  used(key, entry) {\r\n    if (this.newer === key) {\r\n      return;\r\n    }\r\n\r\n    const o = this.items.get(entry.older);\r\n    const n = this.items.get(entry.newer);\r\n    if (o) o.newer = entry.newer;\r\n    if (n) n.older = entry.older;\r\n\r\n    const e = this.items.get(this.newer);\r\n    if (e) {\r\n      e.newer = key;\r\n      entry.older = this.newer;\r\n    }\r\n\r\n    if (!this.older) {\r\n      this.older = key;\r\n    } else if (this.older === key) {\r\n      this.older = entry.newer;\r\n    }\r\n\r\n    this.newer = key;\r\n    entry.newer = null;\r\n  }\r\n\r\n  evict() {\r\n    const key = this.older;\r\n    if (!key) return;\r\n    // console.log('evicting: ' + key);\r\n    const entry = this.items.get(key);\r\n    this.items.delete(key);\r\n    this.older = entry.newer;\r\n  }\r\n\r\n  toString() {\r\n    const buffer = [];\r\n    let key = this.older;\r\n    while (key) {\r\n      buffer.push(key);\r\n      const entry = this.items.get(key);\r\n      key = entry.newer;\r\n    }\r\n\r\n    return buffer.join(' < ');\r\n  }\r\n}\r\n","import Storage from './storage';\r\nimport Viewport from './viewport';\r\nimport World from './world';\r\n\r\nexport default class StaggeredMap {\r\n  constructor(api, tileSize, bounds) {\r\n    this.viewport = new Viewport(new World(tileSize), bounds);\r\n    this.tiles = this.viewport.tiles();\r\n    console.log('staggered map > ctor: tiles: %o', this.tiles);\r\n    const margin = {\r\n      width: Math.ceil(this.tiles.width * 1.2),\r\n      height: Math.ceil(this.tiles.height * 1.2)\r\n    };\r\n    const limit = Math.ceil(margin.width * margin.height * 16);\r\n    this.storage = new Storage(api, margin, limit);\r\n  }\r\n\r\n  update() {\r\n    this.tiles = this.viewport.tiles();\r\n    this.storage.preload(this.tiles);\r\n  }\r\n}\r\n","import Vector from '../math/vector';\r\n\r\nexport const moverMixin = (superclass) => class extends superclass {\r\n  moveTo(tile, duration, elapsed = 0.0) {\r\n    this.target = tile;\r\n    this.duration = duration;\r\n    this.elapsed = elapsed;\r\n    this.moving = true;\r\n    this.targetPosition = new Vector(this.bounds.left, this.bounds.top)\r\n        .add(this.viewport.worldToScreen(tile.x, tile.y))\r\n        .sub(this.viewport.worldToScreen(this.tile.x, this.tile.y));\r\n  }\r\n\r\n  update(delta) {\r\n    if (super.update) {\r\n      super.update(delta);\r\n    }\r\n\r\n    if (!this.moving) {\r\n      return;\r\n    }\r\n\r\n    this.elapsed += delta;\r\n    if (this.elapsed <= 0.0) {\r\n      return;\r\n    }\r\n\r\n    this.position.x = this.bounds.left;\r\n    this.position.y = this.bounds.top;\r\n    const progress = this.elapsed / this.duration;\r\n    if (progress < 1.0) {\r\n      this.position.lerp(this.targetPosition, progress);\r\n    } else {\r\n      this.tile = this.target;\r\n      this.targetPosition = null;\r\n      this.target = null;\r\n      this.moving = false;\r\n    }\r\n  }\r\n};\r\n","import Vector from '../math/vector';\r\n\r\nexport class StaggeredTileRenderer {\r\n  constructor(viewport, tile, bounds) {\r\n    this.viewport = viewport;\r\n    this.tile = tile;\r\n    this.bounds = bounds;\r\n    this.position = new Vector(this.bounds.left, this.bounds.top);\r\n  }\r\n\r\n  draw() {\r\n    const s = this.viewport.worldToScreen(this.tile.x, this.tile.y);\r\n    this.drawTile(s.x + this.position.x, s.y + this.position.y);\r\n  }\r\n}\r\n\r\nexport class StaggeredMapRenderer {\r\n  constructor(map, renderer) {\r\n    this.map = map;\r\n    this.tileSize = map.viewport.world.tileSize;\r\n    this.bounds = map.viewport.bounds;\r\n    this.renderer = renderer;\r\n  }\r\n\r\n  draw() {\r\n    this.renderer.begin();\r\n\r\n    const position = this.map.viewport.position;\r\n    const tiles = this.map.tiles;\r\n    for (let ty = tiles.top; ty <= tiles.bottom; ty++) {\r\n      const shift = ty % 2 ? this.tileSize.halfWidth : 0;\r\n      for (let tx = tiles.left; tx <= tiles.right; tx++) {\r\n        let x = tx * this.tileSize.width + shift - position.x;\r\n        if (x + this.tileSize.width <= 0 || x >= this.bounds.width) {\r\n          continue;\r\n        }\r\n\r\n        let y = ty * this.tileSize.halfHeight - position.y;\r\n\r\n        x += this.bounds.left;\r\n        y += this.bounds.top;\r\n\r\n        this.renderer.drawTile(tx, ty, x, y);\r\n      }\r\n    }\r\n\r\n    const t = this.map.selected;\r\n    if (t) {\r\n      const s = this.map.viewport.worldToScreen(t.x, t.y);\r\n      this.renderer.drawSelected(t.x, t.y, s.x, s.y);\r\n    }\r\n\r\n    this.renderer.end();\r\n  }\r\n}\r\n","import Rectangle from '../math/rectangle';\r\n\r\nimport Cache from './cache';\r\n\r\n\r\nconst makeKey = (x, y) => (y >= 0 ? 'S' + y : 'N' + (-y)) +\r\n  (x >= 0 ? 'E' + x : 'W' + (-x));\r\n\r\nconst RECT_EMPTY = new Rectangle();\r\n\r\nexport default class Storage {\r\n  constructor(api, margin, limit) {\r\n    console.log('storage > ctor: margin: %o, limit: %d', margin, limit);\r\n    this.api = api;\r\n    this.margin = margin;\r\n    this.cache = new Cache(limit);\r\n    this.tiles = RECT_EMPTY;\r\n    this.fetching = new Map();\r\n    this.ref = 0;\r\n    this.refs = new Map();\r\n    api.on('open', this.onopen.bind(this));\r\n    api.on('tiles', this.ontiles.bind(this));\r\n  }\r\n\r\n  get(x, y) {\r\n    const key = makeKey(x, y);\r\n    return this.cache.peek(key);\r\n  }\r\n\r\n  preload(tiles) {\r\n    if (tiles.equals(this.tiles)) {\r\n      return;\r\n    }\r\n\r\n    this.tiles = tiles;\r\n    if (!this.api.isReady()) {\r\n      return;\r\n    }\r\n\r\n    const keys = [];\r\n    const coords = [];\r\n    const xmin = tiles.left - this.margin.width;\r\n    const xmax = tiles.right + this.margin.width;\r\n    const ymin = tiles.top - this.margin.height;\r\n    const ymax = tiles.bottom + this.margin.height;\r\n    for (let y = ymin; y <= ymax; y++) {\r\n      for (let x = xmin; x <= xmax; x++) {\r\n        const key = makeKey(x, y);\r\n        if (!this.cache.touch(key) && !this.fetching.has(key)) {\r\n          this.fetching.set(key);\r\n          keys.push(key);\r\n          coords.push(x - xmin);\r\n          coords.push(y - ymin);\r\n        }\r\n      }\r\n    }\r\n\r\n    const p = {\r\n      t: 'tiles',\r\n      area: [xmin, ymin, xmax - xmin, ymax - ymin]\r\n    };\r\n    if (keys.length > 0) {\r\n      this.refs.set(this.ref, keys);\r\n      p.ref = this.ref;\r\n      p.coords = coords;\r\n\r\n      if (this.ref < 127) {\r\n        this.ref++;\r\n      } else {\r\n        this.ref = 0;\r\n      }\r\n    }\r\n\r\n    this.api.send(p);\r\n  }\r\n\r\n  onopen() {\r\n    this.cache.clear();\r\n    this.tiles = RECT_EMPTY;\r\n    this.fetching.clear();\r\n    this.ref = 0;\r\n    this.refs.clear();\r\n  }\r\n\r\n  ontiles(p) {\r\n    console.log('storage > ontiles: %o', p);\r\n    const keys = this.refs.get(p.ref);\r\n    if (!keys) {\r\n      return;\r\n    }\r\n\r\n    this.refs.delete(p.ref);\r\n    const data = p.data;\r\n    if (keys.length !== data.length) {\r\n      console.log('WARN: #keys <> #data');\r\n      return;\r\n    }\r\n\r\n    keys.forEach((key, i) => {\r\n      this.cache.set(key, data[i]);\r\n      this.fetching.delete(key);\r\n    });\r\n  }\r\n}\r\n","import Rectangle from '../math/rectangle';\r\nimport Vector from '../math/vector';\r\n\r\nexport default class StaggeredMapViewport {\r\n  constructor(world, bounds) {\r\n    this.world = world;\r\n    this.bounds = bounds;\r\n    this.position = new Vector();\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return this.world.screenToWorld(\r\n        x - this.bounds.left + this.position.x,\r\n        y - this.bounds.top + this.position.y);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    const p = this.world.worldToScreen(x, y);\r\n    return {\r\n      x: p.x + this.bounds.left - this.position.x,\r\n      y: p.y + this.bounds.top - this.position.y\r\n    };\r\n  }\r\n\r\n  tiles() {\r\n    const screen = new Rectangle(\r\n        this.position.x, this.position.y,\r\n        this.bounds.width, this.bounds.height);\r\n    return this.world.screenToWorldRectangle(screen);\r\n  }\r\n}\r\n","import Rectangle from '../math/rectangle';\r\n\r\nexport default class StaggeredWorld {\r\n  constructor(tileSize) {\r\n    this.tileSize = tileSize;\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return {\r\n      x: x * this.tileSize.width + (y % 2 ? this.tileSize.halfWidth : 0),\r\n      y: y * this.tileSize.halfHeight\r\n    };\r\n  }\r\n\r\n  /*\r\n    Translates from screen coordinates to\r\n    cortesian coordinates.\r\n\r\n                           ^ y\r\n                           |\r\n                           |\r\n    +---+---+---->     +---+---+\r\n    |oa/|\\ob|   x      |oc/|\\od|\r\n    | / | \\ |          | / | \\ |\r\n    |/ia|ib\\|          |/ic|id\\|\r\n    +---+---+          +---+---+---->\r\n    |\\ic|id/|          |\\ia|ib/|   x\r\n    | \\ | / |          | \\ | / |\r\n    |oc\\|/od|          |oa\\|/ob|\r\n    +---+---+          +---+---+\r\n    |\r\n    | y\r\n    v\r\n\r\n  */\r\n  screenToWorld(x, y) {\r\n    x = Math.round(x);\r\n    y = Math.round(y) + 1; // adjust for rendering overlap.\r\n\r\n    let tx = Math.floor(x / this.tileSize.width);\r\n    let ty = Math.floor(y / this.tileSize.height) * 2;\r\n\r\n    x = Math.floor(x % this.tileSize.width);\r\n    x += x < 0 ? this.tileSize.halfWidth : -this.tileSize.halfWidth;\r\n\r\n    y = Math.floor(y % this.tileSize.height);\r\n    y += y < 0 ? this.tileSize.halfHeight : -this.tileSize.halfHeight;\r\n\r\n    // console.log(tx, ty, x, y);\r\n    if (x < 0) {\r\n      if (y < 0) {\r\n        // case `oa`\r\n        if (-2 * (y + this.tileSize.halfHeight) > x) {\r\n          tx--;\r\n          ty--;\r\n        }\r\n      } else {\r\n        // case `oc`\r\n        if (2 * (y - this.tileSize.halfHeight) > x) {\r\n          tx--;\r\n          ty++;\r\n        }\r\n      }\r\n    } else {\r\n      if (y < 0) {\r\n        // case `ob`\r\n        if (2 * (y + this.tileSize.halfHeight) <= x) {\r\n          ty--;\r\n        }\r\n      } else {\r\n        // case `od`\r\n        if (-2 * (y - this.tileSize.halfHeight) <= x) {\r\n          ty++;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      x: tx,\r\n      y: ty\r\n    };\r\n  }\r\n\r\n  screenToWorldRectangle(screen) {\r\n    const lt = this.screenToWorldLeftTop(\r\n        screen.left, screen.top);\r\n    const rb = this.screenToWorldRightBottom(\r\n        screen.right, screen.bottom);\r\n    return new Rectangle(lt.x, lt.y, rb.x - lt.x, rb.y - lt.y);\r\n  }\r\n\r\n  screenToWorldLeftTop(x, y) {\r\n    // console.log(x, y);\r\n    let tx = Math.floor(x / this.tileSize.width);\r\n    let ty = Math.floor(y / this.tileSize.height) * 2;\r\n\r\n    x %= this.tileSize.width;\r\n    x += (x < 0 ? this.tileSize.halfWidth : -this.tileSize.halfWidth);\r\n\r\n    y %= this.tileSize.height;\r\n    y += (y < 0 ? this.tileSize.halfHeight : -this.tileSize.halfHeight);\r\n\r\n    // console.log(tx, ty, x, y);\r\n    if (x < 0) {\r\n      if (y < 0) {\r\n        // case `a`\r\n        tx--;\r\n        ty--;\r\n      } else {\r\n        // case `c`\r\n        tx--;\r\n      }\r\n    } else {\r\n      if (y < 0) {\r\n        // case `b`\r\n        ty--;\r\n      }\r\n    }\r\n\r\n    return {\r\n      x: tx,\r\n      y: ty\r\n    };\r\n  }\r\n\r\n  screenToWorldRightBottom(x, y) {\r\n    let tx = Math.floor(x / this.tileSize.width);\r\n    let ty = Math.floor(y / this.tileSize.height) * 2;\r\n\r\n    x %= this.tileSize.width;\r\n    if (x == 0) {\r\n      tx--;\r\n    }\r\n\r\n    y %= this.tileSize.height;\r\n    if (y == 0) {\r\n      ty--;\r\n    } else {\r\n      y += (y < 0 ? this.tileSize.halfHeight : -this.tileSize.halfHeight);\r\n      if (y > 0) {\r\n        // case `d`\r\n        ty++;\r\n      }\r\n    }\r\n    return {\r\n      x: tx,\r\n      y: ty\r\n    };\r\n  }\r\n}\r\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n"],"names":["draggable","component","onmousedown","e","addEventListener","onmousemove","onmouseup","movementX","movementY","event","Event","dispatchEvent","removeEventListener","Rectangle","left","top","width","height","other","Vector","x","y","scale","target","progress","Cache","limit","clear","items","Map","size","older","newer","key","entry","get","used","value","undefined","set","evict","o","n","buffer","push","join","Storage","Viewport","World","StaggeredMap","api","tileSize","bounds","viewport","tiles","console","log","margin","Math","ceil","storage","preload","moverMixin","superclass","tile","duration","elapsed","moving","targetPosition","add","worldToScreen","sub","delta","position","lerp","StaggeredTileRenderer","s","drawTile","StaggeredMapRenderer","map","renderer","world","begin","ty","bottom","shift","halfWidth","tx","right","halfHeight","t","selected","drawSelected","end","makeKey","RECT_EMPTY","cache","fetching","ref","refs","on","onopen","bind","ontiles","peek","equals","isReady","keys","coords","xmin","xmax","ymin","ymax","touch","has","p","area","length","send","data","forEach","i","StaggeredMapViewport","screenToWorld","screen","screenToWorldRectangle","StaggeredWorld","round","floor","lt","screenToWorldLeftTop","rb","screenToWorldRightBottom"],"sourceRoot":""}