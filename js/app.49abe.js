!function(e){function t(t){for(var i,s,a=t[0],u=t[1],l=t[2],h=0,f=[];h<a.length;h++)s=a[h],r[s]&&f.push(r[s][0]),r[s]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(c&&c(t);f.length;)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,a=1;a<n.length;a++){var u=n[a];0!==r[u]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={0:0},o=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var c=u;o.push([5,1]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=(i=n(9))&&i.__esModule?i:{default:i},s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"load",value:function(e){var t=[{name:"tiles",url:n(10)},{name:"sphere",url:n(11)}];new o.default(t,this).load(e)}}]),e}();t.default=s},,,,function(e,t,n){"use strict";var i=o(n(6)),r=o(n(12));function o(e){return e&&e.__esModule?e:{default:e}}var s=document.body.appendChild(document.createElement("canvas")),a=new i.default(s);a.screen=new r.default(a),a.start()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=s(n(7)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t,this.ctx=t.getContext("2d"),this.api=new r.default,this.ts=0,this.render=this.render.bind(this)}return i(e,[{key:"start",value:function(){var e=this;if(!this.screen)throw new Error("screen is not set");o.default.load(function(){e.api.connect(),window.requestAnimationFrame(function(t){e.ts=t,e.render(t)})})}},{key:"render",value:function(e){var t=(e-this.ts)/1e3;this.ts=e,this.screen.render(Math.min(t,.06)),window.requestAnimationFrame(this.render)}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=(i=n(8))&&i.__esModule?i:{default:i},a=function(e){return setTimeout(e,750+500*Math.random())},u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventEmitter=new s.default,this.ready=!1,this.objects=[],setTimeout(function(){return setInterval(t.recycle.bind(t),1e3)},5e3)}return o(e,[{key:"connect",value:function(){this.ready=!0,this.eventEmitter.emit("open")}},{key:"isReady",value:function(){return this.ready}},{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"send",value:function(e){var t=this;console.log("api > send: %o",e);var n=e.t;if("tiles"===n){var i=e.coords;if(!i)return;a(function(){for(var n=r(e.area,2)[1],o=[],s=1;s<i.length;s+=2){var a=n+i[s];o.push(Math.abs(a)%2)}t.eventEmitter.emit("tiles",{ref:e.ref,data:o})})}else"place"===n&&a(function(){var n=Math.random().toString(36).substring(2);t.objects.push(n),t.eventEmitter.emit("place",{objects:[{id:n,x:e.x,y:e.y}]})})}},{key:"recycle",value:function(){if(0!==this.objects.length){var e=Math.floor(3*Math.random());0!==e&&this.eventEmitter.emit("remove",{objects:this.objects.splice(0,e)})}}}]),e}();t.default=u},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function s(e){return"object"===(void 0===e?"undefined":i(e))&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,i,r,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(s(n))for(r=Array.prototype.slice.call(arguments,1),i=(l=n.slice()).length,u=0;u<i;u++)l[u].apply(this,r);return!0},r.prototype.addListener=function(e,t){var n;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!o(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var n,i,r,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(n=this._events[e]).length,i=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=r;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(o(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resources=t,this.owner=n||{}}return i(e,[{key:"load",value:function(e){var t=this,n=this.resources.length,i=!0,r=!1,o=void 0;try{for(var s,a=this.resources[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value,l=new Image;this.owner[u.name]=l,l.onload=function(){0==--n&&e(t,t.owner)},l.src=u.url}}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}}}]),e}();t.default=r},function(e,t,n){e.exports=n.p+"static/tiles.fbee9.png"},function(e,t,n){e.exports=n.p+"static/sphere.90a00.png"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=c(n(0)),o=c(n(4)),s=n(3),a=c(n(17)),u=c(n(18)),l=c(n(19));function c(e){return e&&e.__esModule?e:{default:e}}var h={width:128,halfWidth:64,height:64,halfHeight:32},f=new r.default(0,0,3*h.width,3*h.height),v=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,t.canvas.width=f.width,t.canvas.height=f.height,n&&(f.left=h.width+10,f.top=h.height,t.canvas.width+=2*f.left,t.canvas.height+=2*f.top),this.objects=[],this.api=t.api,this.api.on("open",this.onopen.bind(this)),this.api.on("place",this.onplace.bind(this)),this.api.on("remove",this.onremove.bind(this)),this.map=new o.default(t.api,h,f),this.mapRenderer=new s.StaggeredMapRenderer(this.map,new u.default(t.ctx,this.map.storage,h,f,n)),this.controller=new l.default(this)}return i(e,[{key:"render",value:function(e){this.update(e),this.draw()}},{key:"update",value:function(e){this.controller.update(e),this.map.update()}},{key:"draw",value:function(){this.game.ctx.clearRect(0,0,this.game.canvas.width,this.game.canvas.height),this.mapRenderer.draw(),this.objects.forEach(function(e){return e.draw()})}},{key:"onopen",value:function(){this.objects=[]}},{key:"onplace",value:function(e){var t=this;console.log("demo > onplace: %o",e),e.objects.forEach(function(e){if(t.objects.findIndex(function(t){return t.id===e.id})<0){var n=new a.default(t.game.ctx,t.map.viewport,{x:e.x,y:e.y});n.id=e.id,t.objects.push(n)}})}},{key:"onremove",value:function(e){var t=this;console.log("demo > onremove: %o",e),e.objects.forEach(function(e){var n=t.objects.findIndex(function(t){return t.id===e});n>=0&&t.objects.splice(n,1)})}}]),e}();t.default=v},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=a(n(0)),o=n(3),s=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,i,new r.default((n.world.tileSize.width-s.default.sphere.width)/2,(n.world.tileSize.height-s.default.sphere.height)/2,s.default.sphere.width,s.default.sphere.height)));return o.ctx=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.StaggeredTileRenderer),i(t,[{key:"drawTile",value:function(e,t){this.ctx.drawImage(s.default.sphere,e,t)}}]),t}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=(i=n(1))&&i.__esModule?i:{default:i},s=function(){function e(t,n,i,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=t,this.storage=n,this.tileSize=i,this.bounds=r,this.debug=o,o&&(this.ctx.font="12px monospace",this.ctx.fillStyle="white",this.ctx.textAlign="center")}return r(e,[{key:"begin",value:function(){}},{key:"drawTile",value:function(e,t,n,i){var r=this.storage.get(e,t);null!==r?(this.ctx.drawImage(o.default.tiles,this.tileSize.width*r,0,this.tileSize.width,this.tileSize.height,n,i,this.tileSize.width,this.tileSize.height),this.debug&&this.ctx.fillText(e+":"+t,n+this.tileSize.halfWidth,i+this.tileSize.halfHeight+3)):console.log("map renderer > draw tile: (%s:%s) is missing",e,t)}},{key:"drawSelected",value:function(e,t,n,i){}},{key:"end",value:function(){this.debug&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.rect(this.bounds.left,this.bounds.top,this.bounds.width,this.bounds.height),this.ctx.stroke())}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=(i=n(2))&&i.__esModule?i:{default:i},s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.screen=t,this.viewport=t.map.viewport,this.time=0,this.velocity=new o.default,this.place=this.place.bind(this),this.api=t.api,this.api.on("open",this.onopen.bind(this)),this.api.on("close",this.onclose.bind(this)),this.k=-.25,this.b=-.05,this.l=512}return r(e,[{key:"onopen",value:function(){var e=this;this.timer=setTimeout(function(){return setInterval(e.place,250)},3e3)}},{key:"onclose",value:function(){clearInterval(this.timer),this.timer=null}},{key:"update",value:function(e){if(null!==this.timer){this.time+=e,this.time>=3&&(this.time=0,this.velocity.x+=101*Math.random()-50,this.velocity.y+=101*Math.random()-50);var t=this.viewport.position,n=t.x,i=t.y,r=Math.sqrt(n*n+i*i),o=r-this.l,s=o<=0?0:this.k*n*o/r,a=o<=0?0:this.k*i*o/r;this.velocity.x+=e*(s+this.b*this.velocity.x),this.velocity.y+=e*(a+this.b*this.velocity.y),t.scaleAndAdd(this.velocity,e)}}},{key:"place",value:function(){var e=this.screen.map.viewport.tiles();if(this.screen.objects.length<e.width*e.height/2){var t=Math.floor(Math.random()*e.width+1)+e.left,n=Math.floor(Math.random()*e.height+1)+e.top;this.api.send({t:"place",x:t,y:n})}}}]),e}();t.default=s}]);