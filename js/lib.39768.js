(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.left=t,this.top=i,this.width=n,this.height=r}return n(e,[{key:"equals",value:function(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height}},{key:"right",get:function(){return this.left+this.width}},{key:"bottom",get:function(){return this.top+this.height}}]),e}();t.default=r},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i}return n(e,[{key:"scaleAndAdd",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaggeredMapRenderer=t.StaggeredTileRenderer=void 0;var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=(n=i(2))&&n.__esModule?n:{default:n};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.StaggeredTileRenderer=function(){function e(t,i,n){s(this,e),this.viewport=t,this.tile=i,this.bounds=n,this.position=new o.default(this.bounds.left,this.bounds.top)}return r(e,[{key:"draw",value:function(){var e=this.viewport.worldToScreen(this.tile.x,this.tile.y);this.drawTile(e.x+this.position.x,e.y+this.position.y)}}]),e}(),t.StaggeredMapRenderer=function(){function e(t,i){s(this,e),this.map=t,this.tileSize=t.viewport.world.tileSize,this.bounds=t.viewport.bounds,this.renderer=i}return r(e,[{key:"draw",value:function(){this.renderer.begin();for(var e=this.map.viewport.position,t=this.map.tiles,i=t.top;i<=t.bottom;i++)for(var n=i%2?this.tileSize.halfWidth:0,r=t.left;r<=t.right;r++){var o=r*this.tileSize.width+n-e.x;if(!(o+this.tileSize.width<=0||o>=this.bounds.width)){var s=i*this.tileSize.halfHeight-e.y;o+=this.bounds.left,s+=this.bounds.top,this.renderer.drawTile(r,i,o,s)}}var h=this.map.selected;if(h){var l=this.map.viewport.worldToScreen(h.x,h.y);this.renderer.drawSelected(h.x,h.y,l.x,l.y)}this.renderer.end()}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=h(i(13)),o=h(i(15)),s=h(i(16));function h(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewport=new o.default(new s.default(i),n),this.tiles=this.viewport.tiles(),console.log("staggered map > ctor: tiles: %o",this.tiles);var h={width:Math.ceil(1.2*this.tiles.width),height:Math.ceil(1.2*this.tiles.height)},l=Math.ceil(h.width*h.height*16);this.storage=new r.default(t,h,l)}return n(e,[{key:"update",value:function(){this.tiles=this.viewport.tiles(),this.storage.preload(this.tiles)}}]),e}();t.default=l},,,,,,,,,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=s(i(0)),o=s(i(14));function s(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t){return(t>=0?"S"+t:"N"+-t)+(e>=0?"E"+e:"W"+-e)},l=new r.default,a=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("storage > ctor: margin: %o, limit: %d",i,n),this.api=t,this.margin=i,this.cache=new o.default(n),this.tiles=l,this.fetching=new Map,this.ref=0,this.refs=new Map,t.on("open",this.onopen.bind(this)),t.on("tiles",this.ontiles.bind(this))}return n(e,[{key:"get",value:function(e,t){var i=h(e,t);return this.cache.peek(i)}},{key:"preload",value:function(e){if(!e.equals(this.tiles)&&(this.tiles=e,this.api.isReady())){for(var t=[],i=[],n=e.left-this.margin.width,r=e.right+this.margin.width,o=e.top-this.margin.height,s=e.bottom+this.margin.height,l=o;l<=s;l++)for(var a=n;a<=r;a++){var u=h(a,l);this.cache.touch(u)||this.fetching.has(u)||(this.fetching.set(u),t.push(u),i.push(a-n),i.push(l-o))}t.length>0?(this.refs.set(this.ref,t),this.api.send({t:"tiles",area:[n,o,r,s],ref:this.ref,coords:i}),this.ref<127?this.ref++:this.ref=0):this.api.send({t:"tiles",area:[n,o,r,s]})}}},{key:"onopen",value:function(){this.cache.clear(),this.tiles=l,this.fetching.clear(),this.ref=0,this.refs.clear()}},{key:"ontiles",value:function(e){var t=this;console.log("storage > ontiles: %o",e);var i=this.refs.get(e.ref);if(i){this.refs.delete(e.ref);var n=e.data;i.length===n.length?i.forEach(function(e,i){t.cache.set(e,n[i]),t.fetching.delete(e)}):console.log("WARN: #keys <> #data")}}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.limit=t,this.clear()}return n(e,[{key:"clear",value:function(){this.items=new Map,this.size=0,this.older=null,this.newer=null}},{key:"get",value:function(e){var t=this.items.get(e);return t?(this.used(e,t),t.value):null}},{key:"peek",value:function(e){var t=this.items.get(e);return t?t.value:null}},{key:"has",value:function(e){return void 0!==this.items.get(e)}},{key:"touch",value:function(e){var t=this.items.get(e);return!!t&&(this.used(e,t),!0)}},{key:"set",value:function(e,t){var i=this.items.get(e);i||(i={},this.items.set(e,i),this.size<this.limit?this.size++:this.evict()),this.used(e,i),i.value=t}},{key:"remove",value:function(e){var t=this.items.get(e);if(!t)return null;this.size--,this.items.delete(e);var i=t.older,n=t.newer;return this.older===e?this.older=n:this.items.get(i).newer=n,this.newer===e?this.newer=i:this.items.get(n).older=i,t.value}},{key:"used",value:function(e,t){if(this.newer!==e){var i=this.items.get(t.older),n=this.items.get(t.newer);i&&(i.newer=t.newer),n&&(n.older=t.older);var r=this.items.get(this.newer);r&&(r.newer=e,t.older=this.newer),this.older?this.older===e&&(this.older=t.newer):this.older=e,this.newer=e,t.newer=null}}},{key:"evict",value:function(){var e=this.older;if(e){var t=this.items.get(e);this.items.delete(e),this.older=t.newer}}},{key:"toString",value:function(){for(var e=[],t=this.older;t;)e.push(t),t=this.items.get(t).newer;return e.join(" < ")}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=s(i(0)),o=s(i(2));function s(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.bounds=i,this.position=new o.default}return n(e,[{key:"screenToWorld",value:function(e,t){return this.world.screenToWorld(e-this.bounds.left+this.position.x,t-this.bounds.top+this.position.y)}},{key:"worldToScreen",value:function(e,t){var i=this.world.worldToScreen(e,t);return{x:i.x+this.bounds.left-this.position.x,y:i.y+this.bounds.top-this.position.y}}},{key:"tiles",value:function(){var e=new r.default(this.position.x,this.position.y,this.bounds.width,this.bounds.height);return this.world.screenToWorldRectangle(e)}}]),e}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=(n=i(0))&&n.__esModule?n:{default:n},s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tileSize=t}return r(e,[{key:"worldToScreen",value:function(e,t){return{x:e*this.tileSize.width+(t%2?this.tileSize.halfWidth:0),y:t*this.tileSize.halfHeight}}},{key:"screenToWorld",value:function(e,t){e=Math.round(e),t=Math.round(t)+1;var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return e=Math.floor(e%this.tileSize.width),e+=e<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,t=Math.floor(t%this.tileSize.height),t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,e<0?t<0?-2*(t+this.tileSize.halfHeight)>e&&(i--,n--):2*(t-this.tileSize.halfHeight)>e&&(i--,n++):t<0?2*(t+this.tileSize.halfHeight)<=e&&n--:-2*(t-this.tileSize.halfHeight)<=e&&n++,{x:i,y:n}}},{key:"screenToWorldRectangle",value:function(e){var t=this.screenToWorldLeftTop(e.left,e.top),i=this.screenToWorldRightBottom(e.right,e.bottom);return new o.default(t.x,t.y,i.x-t.x,i.y-t.y)}},{key:"screenToWorldLeftTop",value:function(e,t){var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return e%=this.tileSize.width,e+=e<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,t%=this.tileSize.height,t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,e<0?t<0?(i--,n--):i--:t<0&&n--,{x:i,y:n}}},{key:"screenToWorldRightBottom",value:function(e,t){var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return 0==(e%=this.tileSize.width)&&i--,0==(t%=this.tileSize.height)?n--:(t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight)>0&&n++,{x:i,y:n}}}]),e}();t.default=s},,,,function(e,t,i){i(4),e.exports=i(3)}]]);