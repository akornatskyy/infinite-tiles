"use strict";(self.webpackChunkinfinite_tiles=self.webpackChunkinfinite_tiles||[]).push([[628],{247:(t,e,i)=>{function r(t){function e(e){if(0!==e.movementX||0!==e.movementY){var i=new Event("mousedrag");i.movementX=e.movementX,i.movementY=e.movementY,t.dispatchEvent(i)}}function i(r){t.removeEventListener("mousemove",e),t.removeEventListener("mouseleave",i)}return t.addEventListener("mousedown",(function(r){t.addEventListener("mousemove",e),t.addEventListener("mouseleave",i)})),t.addEventListener("mouseup",i),t}i.d(e,{A:()=>r})},874:(t,e,i)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}i.d(e,{A:()=>s});var s=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.left=e,this.top=i,this.width=r,this.height=n},(e=[{key:"right",get:function(){return this.left+this.width}},{key:"bottom",get:function(){return this.top+this.height}},{key:"equals",value:function(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height}}])&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}()},40:(t,e,i)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}i.d(e,{A:()=>s});var s=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i},(e=[{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scaleAndAdd",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"lerp",value:function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this}}])&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}()},355:(t,e,i)=>{i.d(e,{A:()=>x});var r=i(874);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}var u=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.limit=e,this.clear()},e=[{key:"clear",value:function(){this.items=new Map,this.size=0,this.older=null,this.newer=null}},{key:"get",value:function(t){var e=this.items.get(t);return e?(this.used(t,e),e.value):null}},{key:"peek",value:function(t){var e=this.items.get(t);return e?e.value:null}},{key:"has",value:function(t){return void 0!==this.items.get(t)}},{key:"touch",value:function(t){var e=this.items.get(t);return!!e&&(this.used(t,e),!0)}},{key:"set",value:function(t,e){var i=this.items.get(t);i||(i={},this.items.set(t,i),this.size<this.limit?this.size++:this.evict()),this.used(t,i),i.value=e}},{key:"remove",value:function(t){var e=this.items.get(t);if(!e)return null;this.size--,this.items.delete(t);var i=e.older,r=e.newer;return this.older===t?this.older=r:this.items.get(i).newer=r,this.newer===t?this.newer=i:this.items.get(r).older=i,e.value}},{key:"used",value:function(t,e){if(this.newer!==t){var i=this.items.get(e.older),r=this.items.get(e.newer);i&&(i.newer=e.newer),r&&(r.older=e.older);var n=this.items.get(this.newer);n&&(n.newer=t,e.older=this.newer),this.older?this.older===t&&(this.older=e.newer):this.older=t,this.newer=t,e.newer=null}}},{key:"evict",value:function(){var t=this.older;if(t){var e=this.items.get(t);this.items.delete(t),this.older=e.newer}}},{key:"toString",value:function(){for(var t=[],e=this.older;e;)t.push(e),e=this.items.get(e).newer;return t.join(" < ")}}],e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function f(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=l(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==l(e)?e:e+""}var h=function(t,e){return(e>=0?"S"+e:"N"+-e)+(t>=0?"E"+t:"W"+-t)},c=new r.A,y=function(){return t=function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("storage > ctor: margin: %o, limit: %d",i,r),this.api=e,this.margin=i,this.cache=new u(r),this.tiles=c,this.fetching=new Map,this.ref=0,this.refs=new Map,e.on("open",this.onopen.bind(this)),e.on("tiles",this.ontiles.bind(this))},(e=[{key:"get",value:function(t,e){var i=h(t,e);return this.cache.peek(i)}},{key:"preload",value:function(t){if(!t.equals(this.tiles)&&(this.tiles=t,this.api.isReady())){for(var e=[],i=[],r=t.left-this.margin.width,n=t.right+this.margin.width,o=t.top-this.margin.height,s=t.bottom+this.margin.height,u=o;u<=s;u++)for(var l=r;l<=n;l++){var f=h(l,u);this.cache.touch(f)||this.fetching.has(f)||(this.fetching.set(f),e.push(f),i.push(l-r),i.push(u-o))}var a={t:"tiles",area:[r,o,n-r,s-o]};e.length>0&&(this.refs.set(this.ref,e),a.ref=this.ref,a.coords=i,this.ref<127?this.ref++:this.ref=0),this.api.send(a)}}},{key:"onopen",value:function(){this.cache.clear(),this.tiles=c,this.fetching.clear(),this.ref=0,this.refs.clear()}},{key:"ontiles",value:function(t){var e=this;console.log("storage > ontiles: %o",t);var i=this.refs.get(t.ref);if(i){this.refs.delete(t.ref);var r=t.data;i.length===r.length?i.forEach((function(t,i){e.cache.set(t,r[i]),e.fetching.delete(t)})):console.log("WARN: #keys <> #data")}}}])&&f(t.prototype,e),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}(),p=i(40);function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function d(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}var b=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.world=e,this.bounds=i,this.position=new p.A},(e=[{key:"screenToWorld",value:function(t,e){return this.world.screenToWorld(t-this.bounds.left+this.position.x,e-this.bounds.top+this.position.y)}},{key:"worldToScreen",value:function(t,e){var i=this.world.worldToScreen(t,e);return{x:i.x+this.bounds.left-this.position.x,y:i.y+this.bounds.top-this.position.y}}},{key:"tiles",value:function(){var t=new r.A(this.position.x,this.position.y,this.bounds.width,this.bounds.height);return this.world.screenToWorldRectangle(t)}}])&&m(t.prototype,e),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,S(r.key),r)}}function S(t){var e=function(t,e){if("object"!=g(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==g(e)?e:e+""}var j=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tileSize=e},(e=[{key:"worldToScreen",value:function(t,e){return{x:t*this.tileSize.width+(e%2?this.tileSize.halfWidth:0),y:e*this.tileSize.halfHeight}}},{key:"screenToWorld",value:function(t,e){t=Math.round(t),e=Math.round(e)+1;var i=Math.floor(t/this.tileSize.width),r=2*Math.floor(e/this.tileSize.height);return t=Math.floor(t%this.tileSize.width),t+=t<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,e=Math.floor(e%this.tileSize.height),e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,t<0?e<0?-2*(e+this.tileSize.halfHeight)>t&&(i--,r--):2*(e-this.tileSize.halfHeight)>t&&(i--,r++):e<0?2*(e+this.tileSize.halfHeight)<=t&&r--:-2*(e-this.tileSize.halfHeight)<=t&&r++,{x:i,y:r}}},{key:"screenToWorldRectangle",value:function(t){var e=this.screenToWorldLeftTop(t.left,t.top),i=this.screenToWorldRightBottom(t.right,t.bottom);return new r.A(e.x,e.y,i.x-e.x,i.y-e.y)}},{key:"screenToWorldLeftTop",value:function(t,e){var i=Math.floor(t/this.tileSize.width),r=2*Math.floor(e/this.tileSize.height);return t%=this.tileSize.width,t+=t<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,e%=this.tileSize.height,e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,t<0?e<0?(i--,r--):i--:e<0&&r--,{x:i,y:r}}},{key:"screenToWorldRightBottom",value:function(t,e){var i=Math.floor(t/this.tileSize.width),r=2*Math.floor(e/this.tileSize.height);return 0==(t%=this.tileSize.width)&&i--,0==(e%=this.tileSize.height)?r--:(e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight)>0&&r++,{x:i,y:r}}}])&&w(t.prototype,e),i&&w(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}function k(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function O(t){var e=function(t,e){if("object"!=P(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=P(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==P(e)?e:e+""}var x=function(){return t=function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewport=new b(new j(i),r),this.tiles=this.viewport.tiles(),console.log("staggered map > ctor: tiles: %o",this.tiles);var n={width:Math.ceil(1.2*this.tiles.width),height:Math.ceil(1.2*this.tiles.height)},o=Math.ceil(n.width*n.height*16);this.storage=new y(e,n,o)},(e=[{key:"update",value:function(){this.tiles=this.viewport.tiles(),this.storage.preload(this.tiles)}}])&&k(t.prototype,e),i&&k(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}()},654:(t,e,i)=>{i.d(e,{b:()=>y});var r=i(40);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}function u(t,e,i){return e=h(e),function(t,e){if(e&&("object"==n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,l()?Reflect.construct(e,i||[],h(t).constructor):e.apply(t,i))}function l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(l=function(){return!!t})()}function f(t,e,i,r){var n=a(h(1&r?t.prototype:t),e,i);return 2&r&&"function"==typeof n?function(t){return n.apply(i,t)}:n}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}},a.apply(null,arguments)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}var y=function(t){return function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t),i=e,n=[{key:"moveTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.target=t,this.duration=e,this.elapsed=i,this.moving=!0,this.targetPosition=new r.A(this.bounds.left,this.bounds.top).add(this.viewport.worldToScreen(t.x,t.y)).sub(this.viewport.worldToScreen(this.tile.x,this.tile.y))}},{key:"update",value:function(t){if(f(e,"update",this,1)&&f(e,"update",this,3)([t]),this.moving&&(this.elapsed+=t,!(this.elapsed<=0))){this.position.x=this.bounds.left,this.position.y=this.bounds.top;var i=this.elapsed/this.duration;i<1?this.position.lerp(this.targetPosition,i):(this.tile=this.target,this.targetPosition=null,this.target=null,this.moving=!1)}}}],n&&o(i.prototype,n),s&&o(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,n,s}(t)}},327:(t,e,i)=>{i.d(e,{S:()=>a,z:()=>f});var r=i(40);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function u(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}var f=function(){return u((function t(e,i,n){o(this,t),this.viewport=e,this.tile=i,this.bounds=n,this.position=new r.A(this.bounds.left,this.bounds.top)}),[{key:"draw",value:function(){var t=this.viewport.worldToScreen(this.tile.x,this.tile.y);this.drawTile(t.x+this.position.x,t.y+this.position.y)}}])}(),a=function(){return u((function t(e,i){o(this,t),this.map=e,this.tileSize=e.viewport.world.tileSize,this.bounds=e.viewport.bounds,this.renderer=i}),[{key:"draw",value:function(){this.renderer.begin();for(var t=this.map.viewport.position,e=this.map.tiles,i=e.top;i<=e.bottom;i++)for(var r=i%2?this.tileSize.halfWidth:0,n=e.left;n<=e.right;n++){var o=n*this.tileSize.width+r-t.x;if(!(o+this.tileSize.width<=0||o>=this.bounds.width)){var s=i*this.tileSize.halfHeight-t.y;o+=this.bounds.left,s+=this.bounds.top,this.renderer.drawTile(n,i,o,s)}}var u=this.map.selected;if(u){var l=this.map.viewport.worldToScreen(u.x,u.y);this.renderer.drawSelected(u.x,u.y,l.x,l.y)}this.renderer.end()}}])}()},7:t=>{var e,i="object"==typeof Reflect?Reflect:null,r=i&&"function"==typeof i.apply?i.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,o),r(i)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}v(t,e,o,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&v(t,"error",e,i)}(t,n,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function f(t,e,i,r){var n,o,s,f;if(u(i),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),s=o[e]),void 0===s)s=o[e]=i,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=l(t))>0&&s.length>n&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,f=a,console&&console.warn&&console.warn(f)}return t}function a(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=a.bind(r);return n.listener=i,r.wrapFn=n,n}function c(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):p(n,n.length)}function y(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function v(t,e,i,r){if("function"==typeof t.on)r.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(o){r.once&&t.removeEventListener(e,n),i(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var l=o[t];if(void 0===l)return!1;if("function"==typeof l)r(l,this,e);else{var f=l.length,a=p(l,f);for(i=0;i<f;++i)r(a[i],this,e)}return!0},o.prototype.addListener=function(t,e){return f(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return f(this,t,e,!0)},o.prototype.once=function(t,e){return u(e),this.on(t,h(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,h(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,r,n,o,s;if(u(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){s=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,o=Object.keys(i);for(r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return c(this,t,!0)},o.prototype.rawListeners=function(t){return c(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},o.prototype.listenerCount=y,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}}}]);