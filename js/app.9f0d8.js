!function(e){function t(t){for(var i,s,a=t[0],u=t[1],c=t[2],l=0,f=[];l<a.length;l++)s=a[l],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&f.push(r[s][0]),r[s]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(h&&h(t);f.length;)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,a=1;a<n.length;a++){var u=n[a];0!==r[u]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={0:0},o=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var h=u;o.push([7,1]),n()}({6:function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}((e.exports=a).EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,i){var r,o,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),0<(r=c(e))&&s.length>r&&!s.warned){s.warned=!0;var a=Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length}return e}function l(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(i);return r.listener=n,i.wrapFn=r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):v(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(0<t.length&&(s=t[0]),s instanceof Error)throw s;var a=Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,h=v(u,c);for(n=0;n<c;++n)o(h[n],this,t)}return!0},a.prototype.on=a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,l(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,l(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var n,i,r,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;0<=o;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return 0<this._eventsCount?i(this._events):[]}},7:function(e,t,n){"use strict";n.r(t);var i=n(6),r=n.n(i);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var u=function(){function e(){o(this,e),this.eventEmitter=new r.a,this.ready=!1,this.controller=new c(this.eventEmitter)}return a(e,[{key:"connect",value:function(){this.ready=!0,this.eventEmitter.emit("open")}},{key:"isReady",value:function(){return this.ready}},{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"send",value:function(e){var t=this;switch(e.t){case"ping":this.controller.ping(e);break;case"tiles":!function(e){setTimeout(e,750+500*Math.random())}((function(){return t.controller.tiles(e)}));break;case"place":this.controller.place(e);break;case"move":this.controller.move(e)}}}]),e}(),c=function(){function e(t){var n=this;o(this,e),this.eventEmitter=t,this.objects=[],setTimeout((function(){return setInterval(n.recycle.bind(n),1e3)}),5e3)}return a(e,[{key:"ping",value:function(e){this.eventEmitter.emit("pong",{tc:e.time,ts:Date.now()/1e3})}},{key:"tiles",value:function(e){var t=e.coords;if(t){for(var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e.area,2)[1],i=[],r=1;r<t.length;r+=2){var o=n+t[r];i.push(Math.abs(o)%2)}this.eventEmitter.emit("tiles",{ref:e.ref,data:i})}}},{key:"place",value:function(e){var t=Math.random().toString(36).substring(2);this.objects.push(t),this.eventEmitter.emit("place",{objects:[{id:t,x:e.x,y:e.y}]})}},{key:"move",value:function(e){var t=this,n=e.id,i=this.objects.indexOf(n);0<=i&&this.objects.splice(i,1);var r=Date.now(),o=Math.floor(r/1e3),s=1+Math.floor(5*Math.random());this.eventEmitter.emit("move",{objects:[{id:n,x:e.x,y:e.y,time:1+o,duration:s}]}),setTimeout((function(){t.objects.push(n),t.eventEmitter.emit("moved",{id:n})}),1e3*s+(r-1e3*o))}},{key:"recycle",value:function(){if(0!==this.objects.length){var e=Math.floor(3*Math.random());0!=e&&this.eventEmitter.emit("remove",{objects:this.objects.splice(0,e)})}}}]),e}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resources=t,this.owner=n||{}}return function(e,t,n){t&&h(e.prototype,t)}(e,[{key:"load",value:function(e){var t=this,n=this.resources.length,i=!0,r=!1,o=void 0;try{for(var s,a=this.resources[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value,c=new Image;(this.owner[u.name]=c).onload=function(){0==--n&&e(t,t.owner)},c.src=u.url}}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}}}]),e}(),f=n.p+"static/tiles.fbee9.png",p=n.p+"static/sphere.90a00.png";function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){n&&v(e,n)}(e,0,[{key:"load",value:function(e){new l([{name:"tiles",url:f},{name:"sphere",url:p}],this).load(e)}}]),e}();function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(){return Date.now()/1e3}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t,this.ctx=t.getContext("2d"),this.ts=0,this.delta=0,this.render=this.render.bind(this),this.ping=this.ping.bind(this),this.api=new u,this.api.on("open",this.onopen.bind(this)),this.api.on("close",this.onclose.bind(this)),this.api.on("pong",this.onpong.bind(this))}return function(e,t,n){t&&y(e.prototype,t)}(e,[{key:"start",value:function(){var e=this;if(!this.screen)throw Error("screen is not set");d.load((function(){return e.api.connect()}))}},{key:"render",value:function(e){var t=(e-this.ts)/1e3;this.ts=e,this.screen.render(t),this.requestId=window.requestAnimationFrame(this.render)}},{key:"onopen",value:function(){var e=this;this.ping(),this.timer=setInterval(this.ping,1e4),window.requestAnimationFrame((function(t){e.ts=t,e.render(t)}))}},{key:"onclose",value:function(){window.cancelAnimationFrame(this.requestId),this.requestId=null,clearInterval(this.timer),this.timer=null}},{key:"ping",value:function(){this.api.send({t:"ping",time:m()})}},{key:"onpong",value:function(e){var t=m(),n=(t-e.tc)/2,i=e.ts-t;this.delta=i+n}}]),e}(),g=n(0),w=n(5),x=n(2),j=n(3),k=n(4);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M=function(){function e(t,n,i){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,E(e).call(this,n,i,new g.a((n.world.tileSize.width-d.sphere.width)/2,(n.world.tileSize.height-d.sphere.height)/2,d.sphere.width,d.sphere.height)))).ctx=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(e,Object(k.moverMixin)(x.StaggeredTileRenderer)),function(e,t,n){t&&_(e.prototype,t)}(e,[{key:"drawTile",value:function(e,t){if(this.moving)this.ctx.drawImage(d.sphere,e,t);else{var n=this.ctx.globalAlpha;this.ctx.globalAlpha=.9,this.ctx.drawImage(d.sphere,e,t),this.ctx.globalAlpha=n}}}]),e}(),S=n(1);function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function C(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}var I=function(){function e(t){T(this,e),this.pos=t.pos,this.k=t.k,this.b=t.b,this.l=t.l,this.velocity=new S.a}return C(e,[{key:"update",value:function(e){.06<e&&(e=.06);var t=this.pos.x,n=this.pos.y,i=Math.sqrt(t*t+n*n),r=i-this.l,o=0,s=0;if(0<r){var a=this.k*r/i;o=a*t,s=a*n}this.velocity.x+=e*(o+this.b*this.velocity.x),this.velocity.y+=e*(s+this.b*this.velocity.y),this.pos.scaleAndAdd(this.velocity,e)}}]),e}(),A=function(){function e(t){T(this,e),this.screen=t,this.viewport=t.map.viewport,this.placeOrMove=this.placeOrMove.bind(this),this.applyForce=this.applyForce.bind(this),this.api=t.api,this.api.on("open",this.onopen.bind(this)),this.api.on("close",this.onclose.bind(this)),this.spring=new I({pos:this.viewport.position,k:-.25,b:-.05,l:512})}return C(e,[{key:"onopen",value:function(){var e=this;this.forceTimer=setInterval(this.applyForce,3e3),setTimeout((function(){e.timer=setInterval(e.placeOrMove,150)}),2e3)}},{key:"onclose",value:function(){clearInterval(this.timer),clearInterval(this.forceTimer),this.timer=null}},{key:"update",value:function(e){this.spring.update(e)}},{key:"applyForce",value:function(){var e=this.spring.velocity;e.x+=101*Math.random()-50,e.y+=101*Math.random()-50}},{key:"placeOrMove",value:function(){var e=this.screen.map.tiles,t=this.screen.objects,n=Math.floor(Math.random()*e.width+1)+e.left,i=Math.floor(Math.random()*e.height+1)+e.top;if(!t.find((function(e){return!e.moving&&e.tile.x===n&&e.tile.y===i||e.moving&&e.target.x===n&&e.target.y===i})))if(t.length<e.width*e.height/2)this.api.send({t:"place",x:n,y:i});else{var r=t[Math.floor(Math.random()*t.length)];r.moving||this.api.send({t:"move",id:r.id,x:n,y:i})}}}]),e}();function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function e(t,n,i,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=t,this.storage=n,this.tileSize=i,this.bounds=r,(this.debug=o)&&(this.ctx.font="12px monospace",this.ctx.fillStyle="white",this.ctx.textAlign="center")}return function(e,t,n){t&&R(e.prototype,t)}(e,[{key:"begin",value:function(){}},{key:"drawTile",value:function(e,t,n,i){var r=this.storage.get(e,t);null!==r&&(this.ctx.drawImage(d.tiles,this.tileSize.width*r,0,this.tileSize.width,this.tileSize.height,n,i,this.tileSize.width,this.tileSize.height),this.debug&&this.ctx.fillText(e+":"+t,n+this.tileSize.halfWidth,i+this.tileSize.halfHeight+3))}},{key:"drawSelected",value:function(){}},{key:"end",value:function(){this.debug&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.rect(this.bounds.left,this.bounds.top,this.bounds.width,this.bounds.height),this.ctx.stroke())}}]),e}();function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var q={width:128,halfWidth:64,height:64,halfHeight:32},N=new g.a(0,0,3*q.width,3*q.height),D=function(){function e(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(this.game=t).canvas.width=N.width,t.canvas.height=N.height,n&&(N.left=q.width+10,N.top=q.height,t.canvas.width+=2*N.left,t.canvas.height+=2*N.top),this.objects=[],this.sphere=null,this.api=t.api,this.api.on("open",this.onopen.bind(this)),this.api.on("place",this.onplace.bind(this)),this.api.on("remove",this.onremove.bind(this)),this.api.on("move",this.onmove.bind(this)),this.api.on("moved",this.onmoved.bind(this)),this.api.on("errors",this.onerrors.bind(this)),this.map=new w.default(t.api,q,N),this.mapRenderer=new x.StaggeredMapRenderer(this.map,new F(t.ctx,this.map.storage,q,N,n)),Object(j.default)(this.game.canvas).addEventListener("mousedrag",this.onmousedrag.bind(this)),this.controller=new A(this)}return function(e,t,n){t&&z(e.prototype,t)}(e,[{key:"render",value:function(e){this.update(e),this.draw()}},{key:"update",value:function(e){this.controller.update(e),this.map.update(),this.objects.forEach((function(t){return t.update(e)}))}},{key:"draw",value:function(){this.game.ctx.clearRect(0,0,this.game.canvas.width,this.game.canvas.height),this.mapRenderer.draw(),this.objects.forEach((function(e){return e.draw()}))}},{key:"onmousedrag",value:function(e){this.map.viewport.position.x-=e.movementX,this.map.viewport.position.y-=e.movementY}},{key:"onopen",value:function(){this.objects=[]}},{key:"onerrors",value:function(){}},{key:"onplace",value:function(e){var t=this;e.objects.forEach((function(e){var n=e.id,i=t.objects.findIndex((function(e){return e.id===n}));if(0<=i){var r=t.objects[i];r.tile.x=e.x,r.tile.y=e.y}else{var o=new M(t.game.ctx,t.map.viewport,{x:e.x,y:e.y});o.id=e.id,t.objects.unshift(o)}}))}},{key:"onremove",value:function(e){var t=this;e.objects.forEach((function(e){var n=t.objects.findIndex((function(t){return t.id===e}));if(0<=n){var i=t.objects.splice(n,1)[0];t.sphere===i&&(t.sphere=null)}}))}},{key:"onmove",value:function(e){var t=this,n=Date.now()/1e3+this.game.delta;e.objects.forEach((function(e){var i=e.id,r=t.objects.findIndex((function(e){return e.id===i}));if(0<=r){var o=t.objects.splice(r,1)[0];t.objects.push(o);var s=n-e.time;o.moveTo({x:e.x,y:e.y},e.duration,s)}}))}},{key:"onmoved",value:function(e){var t=e.id,n=this.objects.findIndex((function(e){return e.id===t}));if(0<=n){var i=this.objects.splice(n,1)[0];this.objects.unshift(i),this.sphere===i&&(this.sphere=null)}}}]),e}(),W=new b(document.body.appendChild(document.createElement("canvas")));W.screen=new D(W),W.start()}});