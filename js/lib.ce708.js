(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;!function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.left=e,this.top=i,this.width=n,this.height=r}return n(t,[{key:"equals",value:function(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height}},{key:"right",get:function(){return this.left+this.width}},{key:"bottom",get:function(){return this.top+this.height}}]),t}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;!function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=i}return n(t,[{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scaleAndAdd",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"lerp",value:function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this}}]),t}();e.default=r},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StaggeredMapRenderer=e.StaggeredTileRenderer=void 0;var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(n=i(1))&&n.__esModule?n:{default:n};function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.StaggeredTileRenderer=function(){function t(e,i,n){s(this,t),this.viewport=e,this.tile=i,this.bounds=n,this.position=new o.default(this.bounds.left,this.bounds.top)}return r(t,[{key:"draw",value:function(){var t=this.viewport.worldToScreen(this.tile.x,this.tile.y);this.drawTile(t.x+this.position.x,t.y+this.position.y)}}]),t}(),e.StaggeredMapRenderer=function(){function t(e,i){s(this,t),this.map=e,this.tileSize=e.viewport.world.tileSize,this.bounds=e.viewport.bounds,this.renderer=i}return r(t,[{key:"draw",value:function(){this.renderer.begin();for(var t=this.map.viewport.position,e=this.map.tiles,i=e.top;i<=e.bottom;i++)for(var n=i%2?this.tileSize.halfWidth:0,r=e.left;r<=e.right;r++){var o=r*this.tileSize.width+n-t.x;if(!(o+this.tileSize.width<=0||o>=this.bounds.width)){var s=i*this.tileSize.halfHeight-t.y;o+=this.bounds.left,s+=this.bounds.top,this.renderer.drawTile(r,i,o,s)}}var h=this.map.selected;if(h){var l=this.map.viewport.worldToScreen(h.x,h.y);this.renderer.drawSelected(h.x,h.y,l.x,l.y)}this.renderer.end()}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=h(i(14)),o=h(i(16)),s=h(i(17));function h(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,i,n){!function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.viewport=new o.default(new s.default(i),n),this.tiles=this.viewport.tiles(),console.log("staggered map > ctor: tiles: %o",this.tiles);var h={width:Math.ceil(1.2*this.tiles.width),height:Math.ceil(1.2*this.tiles.height)},l=Math.ceil(h.width*h.height*16);this.storage=new r.default(e,h,l)}return n(t,[{key:"update",value:function(){this.tiles=this.viewport.tiles(),this.storage.preload(this.tiles)}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MoverMixin=void 0;var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0},s=(n=i(1))&&n.__esModule?n:{default:n};e.MoverMixin=function(t){return function(e){function i(){return function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,t),r(i,[{key:"moveTo",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.target=t,this.duration=e,this.elapsed=i,this.moving=!0,this.targetPosition=new s.default(this.bounds.left,this.bounds.top).add(this.viewport.worldToScreen(t.x,t.y)).sub(this.viewport.worldToScreen(this.tile.x,this.tile.y))}},{key:"update",value:function(t){if(o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"update",this)&&o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"update",this).call(this,t),this.moving&&(this.elapsed+=t,!(this.elapsed<=0))){this.position.x=this.bounds.left,this.position.y=this.bounds.top;var e=this.elapsed/this.duration;e<1?this.position.lerp(this.targetPosition,e):(this.tile=this.target,this.targetPosition=null,this.target=null,this.moving=!1)}}}]),i}()}},,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(0)),o=s(i(15));function s(t){return t&&t.__esModule?t:{default:t}}var h=function(t,e){return(0<=e?"S"+e:"N"+-e)+(0<=t?"E"+t:"W"+-t)},l=new r.default,u=function(){function t(e,i,n){!function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),console.log("storage > ctor: margin: %o, limit: %d",i,n),this.api=e,this.margin=i,this.cache=new o.default(n),this.tiles=l,this.fetching=new Map,this.ref=0,this.refs=new Map,e.on("open",this.onopen.bind(this)),e.on("tiles",this.ontiles.bind(this))}return n(t,[{key:"get",value:function(t,e){var i=h(t,e);return this.cache.peek(i)}},{key:"preload",value:function(t){if(!t.equals(this.tiles)&&(this.tiles=t,this.api.isReady())){for(var e=[],i=[],n=t.left-this.margin.width,r=t.right+this.margin.width,o=t.top-this.margin.height,s=t.bottom+this.margin.height,l=o;l<=s;l++)for(var u=n;u<=r;u++){var a=h(u,l);this.cache.touch(a)||this.fetching.has(a)||(this.fetching.set(a),e.push(a),i.push(u-n),i.push(l-o))}var f={t:"tiles",area:[n,o,r-n,s-o]};0<e.length&&(this.refs.set(this.ref,e),f.ref=this.ref,f.coords=i,this.ref<127?this.ref++:this.ref=0),this.api.send(f)}}},{key:"onopen",value:function(){this.cache.clear(),this.tiles=l,this.fetching.clear(),this.ref=0,this.refs.clear()}},{key:"ontiles",value:function(t){var e=this;console.log("storage > ontiles: %o",t);var i=this.refs.get(t.ref);if(i){this.refs.delete(t.ref);var n=t.data;i.length===n.length?i.forEach(function(t,i){e.cache.set(t,n[i]),e.fetching.delete(t)}):console.log("WARN: #keys <> #data")}}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.limit=e,this.clear()}return n(t,[{key:"clear",value:function(){this.items=new Map,this.size=0,this.older=null,this.newer=null}},{key:"get",value:function(t){var e=this.items.get(t);return e?(this.used(t,e),e.value):null}},{key:"peek",value:function(t){var e=this.items.get(t);return e?e.value:null}},{key:"has",value:function(t){return void 0!==this.items.get(t)}},{key:"touch",value:function(t){var e=this.items.get(t);return!!e&&(this.used(t,e),!0)}},{key:"set",value:function(t,e){var i=this.items.get(t);i||(i={},this.items.set(t,i),this.size<this.limit?this.size++:this.evict()),this.used(t,i),i.value=e}},{key:"remove",value:function(t){var e=this.items.get(t);if(!e)return null;this.size--,this.items.delete(t);var i=e.older,n=e.newer;return this.older===t?this.older=n:this.items.get(i).newer=n,this.newer===t?this.newer=i:this.items.get(n).older=i,e.value}},{key:"used",value:function(t,e){if(this.newer!==t){var i=this.items.get(e.older),n=this.items.get(e.newer);i&&(i.newer=e.newer),n&&(n.older=e.older);var r=this.items.get(this.newer);r&&(r.newer=t,e.older=this.newer),this.older?this.older===t&&(this.older=e.newer):this.older=t,this.newer=t,e.newer=null}}},{key:"evict",value:function(){var t=this.older;if(t){var e=this.items.get(t);this.items.delete(t),this.older=e.newer}}},{key:"toString",value:function(){for(var t=[],e=this.older;e;)t.push(e),e=this.items.get(e).newer;return t.join(" < ")}}]),t}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=s(i(0)),o=s(i(1));function s(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,i){!function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.world=e,this.bounds=i,this.position=new o.default}return n(t,[{key:"screenToWorld",value:function(t,e){return this.world.screenToWorld(t-this.bounds.left+this.position.x,e-this.bounds.top+this.position.y)}},{key:"worldToScreen",value:function(t,e){var i=this.world.worldToScreen(t,e);return{x:i.x+this.bounds.left-this.position.x,y:i.y+this.bounds.top-this.position.y}}},{key:"tiles",value:function(){var t=new r.default(this.position.x,this.position.y,this.bounds.width,this.bounds.height);return this.world.screenToWorldRectangle(t)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(n=i(0))&&n.__esModule?n:{default:n},s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tileSize=e}return r(t,[{key:"worldToScreen",value:function(t,e){return{x:t*this.tileSize.width+(e%2?this.tileSize.halfWidth:0),y:e*this.tileSize.halfHeight}}},{key:"screenToWorld",value:function(t,e){t=Math.round(t),e=Math.round(e)+1;var i=Math.floor(t/this.tileSize.width),n=2*Math.floor(e/this.tileSize.height);return t=Math.floor(t%this.tileSize.width),t+=t<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,e=Math.floor(e%this.tileSize.height),e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,t<0?e<0?-2*(e+this.tileSize.halfHeight)>t&&(i--,n--):2*(e-this.tileSize.halfHeight)>t&&(i--,n++):e<0?2*(e+this.tileSize.halfHeight)<=t&&n--:-2*(e-this.tileSize.halfHeight)<=t&&n++,{x:i,y:n}}},{key:"screenToWorldRectangle",value:function(t){var e=this.screenToWorldLeftTop(t.left,t.top),i=this.screenToWorldRightBottom(t.right,t.bottom);return new o.default(e.x,e.y,i.x-e.x,i.y-e.y)}},{key:"screenToWorldLeftTop",value:function(t,e){var i=Math.floor(t/this.tileSize.width),n=2*Math.floor(e/this.tileSize.height);return t%=this.tileSize.width,t+=t<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,e%=this.tileSize.height,e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,t<0?e<0?(i--,n--):i--:e<0&&n--,{x:i,y:n}}},{key:"screenToWorldRightBottom",value:function(t,e){var i=Math.floor(t/this.tileSize.width),n=2*Math.floor(e/this.tileSize.height);return 0==(t%=this.tileSize.width)&&i--,0==(e%=this.tileSize.height)?n--:0<(e+=e<0?this.tileSize.halfHeight:-this.tileSize.halfHeight)&&n++,{x:i,y:n}}}]),t}();e.default=s},,,,function(t,e,i){i(4),i(5),t.exports=i(3)}]]);