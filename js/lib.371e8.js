(self.webpackChunkinfinite_tiles=self.webpackChunkinfinite_tiles||[]).push([[647],{388:(e,t,i)=>{"use strict";function n(e){function t(t){if(0!==t.movementX||0!==t.movementY){var i=new Event("mousedrag");i.movementX=t.movementX,i.movementY=t.movementY,e.dispatchEvent(i)}}function i(n){e.removeEventListener("mousemove",t),e.removeEventListener("mouseleave",i)}return e.addEventListener("mousedown",(function(n){e.addEventListener("mousemove",t),e.addEventListener("mouseleave",i)})),e.addEventListener("mouseup",i),e}i.d(t,{Z:()=>n})},50:(e,t,i)=>{"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,{Z:()=>o});var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n(this,e),this.left=t,this.top=i,this.width=r,this.height=o}var t,i,o;return t=e,(i=[{key:"right",get:function(){return this.left+this.width}},{key:"bottom",get:function(){return this.top+this.height}},{key:"equals",value:function(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height}}])&&r(t.prototype,i),o&&r(t,o),e}()},49:(e,t,i)=>{"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,{Z:()=>o});var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,e),this.x=t,this.y=i}var t,i,o;return t=e,(i=[{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"scaleAndAdd",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"lerp",value:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}}])&&r(t.prototype,i),o&&r(t,o),e}()},75:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var n=i(50);function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.limit=t,this.clear()}var t,i,n;return t=e,(i=[{key:"clear",value:function(){this.items=new Map,this.size=0,this.older=null,this.newer=null}},{key:"get",value:function(e){var t=this.items.get(e);return t?(this.used(e,t),t.value):null}},{key:"peek",value:function(e){var t=this.items.get(e);return t?t.value:null}},{key:"has",value:function(e){return void 0!==this.items.get(e)}},{key:"touch",value:function(e){var t=this.items.get(e);return!!t&&(this.used(e,t),!0)}},{key:"set",value:function(e,t){var i=this.items.get(e);i||(i={},this.items.set(e,i),this.size<this.limit?this.size++:this.evict()),this.used(e,i),i.value=t}},{key:"remove",value:function(e){var t=this.items.get(e);if(!t)return null;this.size--,this.items.delete(e);var i=t.older,n=t.newer;return this.older===e?this.older=n:this.items.get(i).newer=n,this.newer===e?this.newer=i:this.items.get(n).older=i,t.value}},{key:"used",value:function(e,t){if(this.newer!==e){var i=this.items.get(t.older),n=this.items.get(t.newer);i&&(i.newer=t.newer),n&&(n.older=t.older);var r=this.items.get(this.newer);r&&(r.newer=e,t.older=this.newer),this.older?this.older===e&&(this.older=t.newer):this.older=e,this.newer=e,t.newer=null}}},{key:"evict",value:function(){var e=this.older;if(e){var t=this.items.get(e);this.items.delete(e),this.older=t.newer}}},{key:"toString",value:function(){for(var e=[],t=this.older;t;)e.push(t),t=this.items.get(t).newer;return e.join(" < ")}}])&&r(t.prototype,i),n&&r(t,n),e}();function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(e,t){return(t>=0?"S"+t:"N"+-t)+(e>=0?"E"+e:"W"+-e)},l=new n.Z,a=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("storage > ctor: margin: %o, limit: %d",i,n),this.api=t,this.margin=i,this.cache=new o(n),this.tiles=l,this.fetching=new Map,this.ref=0,this.refs=new Map,t.on("open",this.onopen.bind(this)),t.on("tiles",this.ontiles.bind(this))}var t,i,n;return t=e,(i=[{key:"get",value:function(e,t){var i=h(e,t);return this.cache.peek(i)}},{key:"preload",value:function(e){if(!e.equals(this.tiles)&&(this.tiles=e,this.api.isReady())){for(var t=[],i=[],n=e.left-this.margin.width,r=e.right+this.margin.width,o=e.top-this.margin.height,s=e.bottom+this.margin.height,l=o;l<=s;l++)for(var a=n;a<=r;a++){var u=h(a,l);this.cache.touch(u)||this.fetching.has(u)||(this.fetching.set(u),t.push(u),i.push(a-n),i.push(l-o))}var f={t:"tiles",area:[n,o,r-n,s-o]};t.length>0&&(this.refs.set(this.ref,t),f.ref=this.ref,f.coords=i,this.ref<127?this.ref++:this.ref=0),this.api.send(f)}}},{key:"onopen",value:function(){this.cache.clear(),this.tiles=l,this.fetching.clear(),this.ref=0,this.refs.clear()}},{key:"ontiles",value:function(e){var t=this;console.log("storage > ontiles: %o",e);var i=this.refs.get(e.ref);if(i){this.refs.delete(e.ref);var n=e.data;i.length===n.length?i.forEach((function(e,i){t.cache.set(e,n[i]),t.fetching.delete(e)})):console.log("WARN: #keys <> #data")}}}])&&s(t.prototype,i),n&&s(t,n),e}(),u=i(49);function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.bounds=i,this.position=new u.Z}var t,i,r;return t=e,(i=[{key:"screenToWorld",value:function(e,t){return this.world.screenToWorld(e-this.bounds.left+this.position.x,t-this.bounds.top+this.position.y)}},{key:"worldToScreen",value:function(e,t){var i=this.world.worldToScreen(e,t);return{x:i.x+this.bounds.left-this.position.x,y:i.y+this.bounds.top-this.position.y}}},{key:"tiles",value:function(){var e=new n.Z(this.position.x,this.position.y,this.bounds.width,this.bounds.height);return this.world.screenToWorldRectangle(e)}}])&&f(t.prototype,i),r&&f(t,r),e}();function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tileSize=t}var t,i,r;return t=e,(i=[{key:"worldToScreen",value:function(e,t){return{x:e*this.tileSize.width+(t%2?this.tileSize.halfWidth:0),y:t*this.tileSize.halfHeight}}},{key:"screenToWorld",value:function(e,t){e=Math.round(e),t=Math.round(t)+1;var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return e=Math.floor(e%this.tileSize.width),e+=e<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,t=Math.floor(t%this.tileSize.height),t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,e<0?t<0?-2*(t+this.tileSize.halfHeight)>e&&(i--,n--):2*(t-this.tileSize.halfHeight)>e&&(i--,n++):t<0?2*(t+this.tileSize.halfHeight)<=e&&n--:-2*(t-this.tileSize.halfHeight)<=e&&n++,{x:i,y:n}}},{key:"screenToWorldRectangle",value:function(e){var t=this.screenToWorldLeftTop(e.left,e.top),i=this.screenToWorldRightBottom(e.right,e.bottom);return new n.Z(t.x,t.y,i.x-t.x,i.y-t.y)}},{key:"screenToWorldLeftTop",value:function(e,t){var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return e%=this.tileSize.width,e+=e<0?this.tileSize.halfWidth:-this.tileSize.halfWidth,t%=this.tileSize.height,t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight,e<0?t<0?(i--,n--):i--:t<0&&n--,{x:i,y:n}}},{key:"screenToWorldRightBottom",value:function(e,t){var i=Math.floor(e/this.tileSize.width),n=2*Math.floor(t/this.tileSize.height);return 0==(e%=this.tileSize.width)&&i--,0==(t%=this.tileSize.height)?n--:(t+=t<0?this.tileSize.halfHeight:-this.tileSize.halfHeight)>0&&n++,{x:i,y:n}}}])&&v(t.prototype,i),r&&v(t,r),e}();function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewport=new c(new p(i),n),this.tiles=this.viewport.tiles(),console.log("staggered map > ctor: tiles: %o",this.tiles);var r={width:Math.ceil(1.2*this.tiles.width),height:Math.ceil(1.2*this.tiles.height)},o=Math.ceil(r.width*r.height*16);this.storage=new a(t,r,o)}var t,i,n;return t=e,(i=[{key:"update",value:function(){this.tiles=this.viewport.tiles(),this.storage.preload(this.tiles)}}])&&d(t.prototype,i),n&&d(t,n),e}()},817:(e,t,i)=>{"use strict";i.d(t,{c:()=>c});var n=i(49);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=f(e);if(t){var r=f(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return u(this,i)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=function(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(c,e);var t,i,r,u=a(c);function c(){return o(this,c),u.apply(this,arguments)}return t=c,(i=[{key:"moveTo",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.target=e,this.duration=t,this.elapsed=i,this.moving=!0,this.targetPosition=new n.Z(this.bounds.left,this.bounds.top).add(this.viewport.worldToScreen(e.x,e.y)).sub(this.viewport.worldToScreen(this.tile.x,this.tile.y))}},{key:"update",value:function(e){if(h(f(c.prototype),"update",this)&&h(f(c.prototype),"update",this).call(this,e),this.moving&&(this.elapsed+=e,!(this.elapsed<=0))){this.position.x=this.bounds.left,this.position.y=this.bounds.top;var t=this.elapsed/this.duration;t<1?this.position.lerp(this.targetPosition,t):(this.tile=this.target,this.targetPosition=null,this.target=null,this.moving=!1)}}}])&&s(t.prototype,i),r&&s(t,r),c}(e)}},126:(e,t,i)=>{"use strict";i.d(t,{R:()=>h,t:()=>l});var n=i(49);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}var h=function(){function e(t,i,o){r(this,e),this.viewport=t,this.tile=i,this.bounds=o,this.position=new n.Z(this.bounds.left,this.bounds.top)}return s(e,[{key:"draw",value:function(){var e=this.viewport.worldToScreen(this.tile.x,this.tile.y);this.drawTile(e.x+this.position.x,e.y+this.position.y)}}]),e}(),l=function(){function e(t,i){r(this,e),this.map=t,this.tileSize=t.viewport.world.tileSize,this.bounds=t.viewport.bounds,this.renderer=i}return s(e,[{key:"draw",value:function(){this.renderer.begin();for(var e=this.map.viewport.position,t=this.map.tiles,i=t.top;i<=t.bottom;i++)for(var n=i%2?this.tileSize.halfWidth:0,r=t.left;r<=t.right;r++){var o=r*this.tileSize.width+n-e.x;if(!(o+this.tileSize.width<=0||o>=this.bounds.width)){var s=i*this.tileSize.halfHeight-e.y;o+=this.bounds.left,s+=this.bounds.top,this.renderer.drawTile(r,i,o,s)}}var h=this.map.selected;if(h){var l=this.map.viewport.worldToScreen(h.x,h.y);this.renderer.drawSelected(h.x,h.y,l.x,l.y)}this.renderer.end()}}]),e}()},187:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,n){function r(){void 0!==o&&e.removeListener("error",o),i([].slice.call(arguments))}var o;"error"!==t&&(o=function(i){e.removeListener(t,r),n(i)},e.once("error",o)),e.once(t,r)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function h(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function a(e,t,i,n){var r,o,s,a;if(h(i),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=u.bind(n);return r.listener=i,n.wrapFn=r,r}function c(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):p(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var h=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw h.context=s,h}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var a=l.length,u=p(l,a);for(i=0;i<a;++i)n(u[i],this,t)}return!0},o.prototype.addListener=function(e,t){return a(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return a(this,e,t,!0)},o.prototype.once=function(e,t){return h(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return h(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,n,r,o,s;if(h(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return c(this,e,!0)},o.prototype.rawListeners=function(e){return c(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}}]);